sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/base/Object",                                                                                                                                                                                                                                         
	"sap/ui/model/json/JSONModel"                                                                                                                                                                                                                                 
], function(Object, JSONModel) {                                                                                                                                                                                                                               
	"use strict";                                                                                                                                                                                                                                                 
	return Object.extend("com.mscg.applications.common.Configuration", {                                                                                                                                                                                          
		_oModel: null,                                                                                                                                                                                                                                               
		_sConfigurationSetName: null,                                                                                                                                                                                                                                
		_oConfigModel: null,                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
		constructor: function(data) {                                                                                                                                                                                                                                
			if (data) {                                                                                                                                                                                                                                                 
				this._oModel = data.model;                                                                                                                                                                                                                                 
				this._sConfigurationSetName = data.configurationSetName;                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
				this._oModel.read(this.sConfigurationSetName, {                                                                                                                                                                                                            
					success: function(oData, response) {                                                                                                                                                                                                                      
						var oObject = this._buildConfigModel(oData.results, this);                                                                                                                                                                                               
						this._oConfigModel = new JSONModel(oObject);                                                                                                                                                                                                             
					},                                                                                                                                                                                                                                                        
					error: function(oError) {                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		getConfigModel: function() {                                                                                                                                                                                                                                 
			return this._oConfigModel;                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_buildConfigModel: function(aResults) {                                                                                                                                                                                                                      
			var oObject = {};                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			for (var i = 0; i < aResults.length; i++) {                                                                                                                                                                                                                 
				var keyParts = aResults[i].configKey.split(".");                                                                                                                                                                                                           
				var oParent = oObject;                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
				for (var x = 0; x < keyParts.length; x++) {                                                                                                                                                                                                                
					var key = keyParts[x];                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
					// Is this the value node?                                                                                                                                                                                                                                
					if (x === keyParts.length - 1) {                                                                                                                                                                                                                          
						// Yes                                                                                                                                                                                                                                                   
						oParent = this._constructChild(oParent, key, aResults[i].configValue);                                                                                                                                                                                   
					} else {                                                                                                                                                                                                                                                  
						// No                                                                                                                                                                                                                                                    
						oParent = this._constructChild(oParent, key, null);                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			return oObject;                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_constructChild: function(oParent, sNode, sValue) {                                                                                                                                                                                                          
			if (sValue === null) {                                                                                                                                                                                                                                      
				// Structure node.                                                                                                                                                                                                                                         
				oParent[sNode] = {};                                                                                                                                                                                                                                       
				return oParent[sNode];                                                                                                                                                                                                                                     
			} else {                                                                                                                                                                                                                                                    
				// Value node.                                                                                                                                                                                                                                             
				oParent[sNode] = sValue;                                                                                                                                                                                                                                   
				return oParent;                                                                                                                                                                                                                                            
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            