sap.ui.define([                                                                                                                                                                                                                                                
	"com/mscg/applications/cubiscan/worklist/controller/BaseController",                                                                                                                                                                                          
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/ui/core/routing/History",                                                                                                                                                                                                                                
	"com/mscg/applications/cubiscan/worklist/model/formatter",                                                                                                                                                                                                    
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
	"sap/ui/core/util/Export",                                                                                                                                                                                                                                    
	"sap/ui/core/util/ExportTypeCSV"                                                                                                                                                                                                                              
], function(BaseController, JSONModel, History, formatter, Filter, FilterOperator, Export, ExportTypeCSV) {                                                                                                                                                    
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return BaseController.extend("com.mscg.applications.cubiscan.worklist.controller.Worklist", {                                                                                                                                                                 
                                                                                                                                                                                                                                                               
		formatter: formatter,                                                                                                                                                                                                                                        
		_oTable: null,                                                                                                                                                                                                                                               
		_oMessagesDialog: null,                                                                                                                                                                                                                                      
		_oViewSettingsDialog: null,                                                                                                                                                                                                                                  
		_aFilters: [],                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		// Used to maintain a list of the updates/deletes currently in process.                                                                                                                                                                                      
		_aInProcessQueue: [],                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		// Used to combine the messages from the different update/delete tasks.                                                                                                                                                                                      
		_oMessages: null,                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* lifecycle methods                                           */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the worklist controller is instantiated.                                                                                                                                                                                                      
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onInit: function() {                                                                                                                                                                                                                                         
			var oViewModel,                                                                                                                                                                                                                                             
				iOriginalBusyDelay,                                                                                                                                                                                                                                        
				oTable = this.byId("worklistTable");                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			var oEventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                             
			oEventBus.subscribe("com.mscg.applications.cubiscan.worklist.FioriConfiguration", "Loaded", this.onLoadWorklistData, this);                                                                                                                                 
                                                                                                                                                                                                                                                               
			// Put down worklist table's original value for busy indicator delay,                                                                                                                                                                                       
			// so it can be restored later on. Busy handling on the table is                                                                                                                                                                                            
			// taken care of by the table itself.                                                                                                                                                                                                                       
			iOriginalBusyDelay = oTable.getBusyIndicatorDelay();                                                                                                                                                                                                        
			// keeps the search state                                                                                                                                                                                                                                   
			this._aTableSearchState = [];                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			// Model used to manipulate control states                                                                                                                                                                                                                  
			oViewModel = new JSONModel({                                                                                                                                                                                                                                
				worklistTableTitle: this.getResourceBundle().getText("worklistTableTitle"),                                                                                                                                                                                
				saveAsTileTitle: this.getResourceBundle().getText("saveAsTileTitle", this.getResourceBundle().getText("worklistViewTitle")),                                                                                                                               
				shareOnJamTitle: this.getResourceBundle().getText("worklistTitle"),                                                                                                                                                                                        
				shareSendEmailSubject: this.getResourceBundle().getText("shareSendEmailWorklistSubject"),                                                                                                                                                                  
				shareSendEmailMessage: this.getResourceBundle().getText("shareSendEmailWorklistMessage", [location.href]),                                                                                                                                                 
				tableNoDataText: this.getResourceBundle().getText("tableNoDataText"),                                                                                                                                                                                      
				tableBusyDelay: 0,                                                                                                                                                                                                                                         
				selectedWarehouseNumber: "0500"                                                                                                                                                                                                                            
			});                                                                                                                                                                                                                                                         
			this.setModel(oViewModel, "worklistView");                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// Make sure, busy indication is showing immediately so there is no                                                                                                                                                                                         
			// break after the busy indication for loading the view's meta data is                                                                                                                                                                                      
			// ended (see promise 'oWhenMetadataIsLoaded' in AppController)                                                                                                                                                                                             
			oTable.attachEventOnce("updateFinished", function() {                                                                                                                                                                                                       
				// Restore original busy indicator delay for worklist's table                                                                                                                                                                                              
				oViewModel.setProperty("/tableBusyDelay", iOriginalBusyDelay);                                                                                                                                                                                             
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			this._oTable = oTable;                                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onExit: function() {                                                                                                                                                                                                                                         
			var oEventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                             
			oEventBus.unsubscribe("com.mscg.applications.cubiscan.worklist.FioriConfiguration", "Loaded", this.onLoadWorklistData, this);                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* event handlers                                              */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Triggered by the table's 'updateFinished' event: after new table                                                                                                                                                                                          
		 * data is available, this handler method updates the table counter.                                                                                                                                                                                         
		 * This should only happen if the update was successful, which is                                                                                                                                                                                            
		 * why this handler is attached to 'updateFinished' and not to the                                                                                                                                                                                           
		 * table's list binding's 'dataReceived' method.                                                                                                                                                                                                             
		 * @param {sap.ui.base.Event} oEvent the update finished event                                                                                                                                                                                               
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onUpdateFinished: function(oEvent) {                                                                                                                                                                                                                         
			// update the worklist's object counter after the table update                                                                                                                                                                                              
			var sTitle,                                                                                                                                                                                                                                                 
				oTable = oEvent.getSource(),                                                                                                                                                                                                                               
				iTotalItems = oEvent.getParameter("total");                                                                                                                                                                                                                
			// only update the counter if the length is final and                                                                                                                                                                                                       
			// the table is not empty                                                                                                                                                                                                                                   
			if (iTotalItems && oTable.getBinding("items").isLengthFinal()) {                                                                                                                                                                                            
				sTitle = this.getResourceBundle().getText("worklistTableTitleCount", [iTotalItems]);                                                                                                                                                                       
			} else {                                                                                                                                                                                                                                                    
				sTitle = this.getResourceBundle().getText("worklistTableTitle");                                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
			this.getModel("worklistView").setProperty("/worklistTableTitle", sTitle);                                                                                                                                                                                   
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler when a table item gets pressed                                                                                                                                                                                                              
		 * @param {sap.ui.base.Event} oEvent the table selectionChange event                                                                                                                                                                                         
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onPress: function(oEvent) {                                                                                                                                                                                                                                  
			// The source is the list item that got pressed                                                                                                                                                                                                             
			this._showObject(oEvent.getSource());                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onLoadWorklistData: function(sChannel, sEvent, oData) {                                                                                                                                                                                                      
			// Define the filters for use in the binding of the items.                                                                                                                                                                                                  
			var aFilters = this._constructFilters();                                                                                                                                                                                                                    
			this._bindData(this._oTable, aFilters);                                                                                                                                                                                                                     
			this._aFilters = aFilters;                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for the export data/download function                                                                                                                                                                                                       
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @param {object} oEvent - Event object                                                                                                                                                                                                                     
		 */                                                                                                                                                                                                                                                          
		onDownloadItems: sap.m.Table.prototype.exportData || function(oEvent) {                                                                                                                                                                                      
			var oModel = this.getModel();                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			oModel.read("/WorklistItemSet", {                                                                                                                                                                                                                           
				filters: this._aFilters,                                                                                                                                                                                                                                   
				success: function(oData, oResponse) {                                                                                                                                                                                                                      
					var oJsonModel = new JSONModel(oData);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
					var oExport = new Export({                                                                                                                                                                                                                                
						exportType: new ExportTypeCSV({                                                                                                                                                                                                                          
							fileExtension: "csv",                                                                                                                                                                                                                                   
							separatorChar: ","                                                                                                                                                                                                                                      
						}),                                                                                                                                                                                                                                                      
						models: oJsonModel,                                                                                                                                                                                                                                      
						rows: {                                                                                                                                                                                                                                                  
							path: "/results"                                                                                                                                                                                                                                        
						},                                                                                                                                                                                                                                                       
						columns: [{                                                                                                                                                                                                                                              
							name: "Product",                                                                                                                                                                                                                                        
							template: {                                                                                                                                                                                                                                             
								content: "{product}"                                                                                                                                                                                                                                   
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "UOM",                                                                                                                                                                                                                                            
							template: {                                                                                                                                                                                                                                             
								content: "{unitOfMeasure}"                                                                                                                                                                                                                             
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Status",                                                                                                                                                                                                                                         
							template: {                                                                                                                                                                                                                                             
								content: "{status}"                                                                                                                                                                                                                                    
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Length",                                                                                                                                                                                                                                         
							template: {                                                                                                                                                                                                                                             
								content: "{length}"                                                                                                                                                                                                                                    
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Width",                                                                                                                                                                                                                                          
							template: {                                                                                                                                                                                                                                             
								content: "{width}"                                                                                                                                                                                                                                     
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Height",                                                                                                                                                                                                                                         
							template: {                                                                                                                                                                                                                                             
								content: "{height}"                                                                                                                                                                                                                                    
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Dimension UOM",                                                                                                                                                                                                                                  
							template: {                                                                                                                                                                                                                                             
								content: "{dimensionUom}"                                                                                                                                                                                                                              
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Gross Weight",                                                                                                                                                                                                                                   
							template: {                                                                                                                                                                                                                                             
								content: "{grossWeight}"                                                                                                                                                                                                                               
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Net Weight",                                                                                                                                                                                                                                     
							template: {                                                                                                                                                                                                                                             
								content: "{netWeight}"                                                                                                                                                                                                                                 
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Weight UOM",                                                                                                                                                                                                                                     
							template: {                                                                                                                                                                                                                                             
								content: "{weightUom}"                                                                                                                                                                                                                                 
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Volume",                                                                                                                                                                                                                                         
							template: {                                                                                                                                                                                                                                             
								content: "{volume}"                                                                                                                                                                                                                                    
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Volume UOM",                                                                                                                                                                                                                                     
							template: {                                                                                                                                                                                                                                             
								content: "{volumeUom}"                                                                                                                                                                                                                                 
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "ECC Updated",                                                                                                                                                                                                                                    
							template: {                                                                                                                                                                                                                                             
								content: "{updatedEcc}"                                                                                                                                                                                                                                
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Updated By",                                                                                                                                                                                                                                     
							template: {                                                                                                                                                                                                                                             
								content: "{eccUpdatedBy}"                                                                                                                                                                                                                              
							}                                                                                                                                                                                                                                                       
						}, {                                                                                                                                                                                                                                                     
							name: "Updated Date",                                                                                                                                                                                                                                   
							template: {                                                                                                                                                                                                                                             
								content: "{eccUpdatedTimestamp}"                                                                                                                                                                                                                       
							}                                                                                                                                                                                                                                                       
						}]                                                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					var sFileName = "Worklist_Items_" + new Date().toISOString();                                                                                                                                                                                             
					oExport.saveFile(sFileName).catch(function(oError) {}).then(function() {                                                                                                                                                                                  
						sap.m.MessageToast.show("Worklist Items exported.");                                                                                                                                                                                                     
						oExport.destroy();                                                                                                                                                                                                                                       
					});                                                                                                                                                                                                                                                       
				},                                                                                                                                                                                                                                                         
				error: function(oError) {                                                                                                                                                                                                                                  
					sap.m.MessageBox.error("An unknown error occurred during the download function", {                                                                                                                                                                        
						styleClass: "sapUiSizeCompact"                                                                                                                                                                                                                           
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for the Clear Worklist button.                                                                                                                                                                                                              
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @param {object} oEvent - Event object                                                                                                                                                                                                                     
		 */                                                                                                                                                                                                                                                          
		onClearWorklist: function(oEvent) {                                                                                                                                                                                                                          
			sap.m.MessageBox.confirm("Click 'Ok' if you choose to delete all entries from the worklist, otherwise click 'Cancel'", {                                                                                                                                    
				title: "Confirm Deletion",                                                                                                                                                                                                                                 
				styleClass: "sapUiSizeCompact",                                                                                                                                                                                                                            
				onClose: this._clearWorklist.bind(this)                                                                                                                                                                                                                    
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for the View Settings Dialog button.                                                                                                                                                                                                        
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @param {object} oEvent - Event object                                                                                                                                                                                                                     
		 */                                                                                                                                                                                                                                                          
		handleViewSettingsDialogButtonPressed: function(oEvent) {                                                                                                                                                                                                    
			if (!this._oViewSettingsDialog) {                                                                                                                                                                                                                           
				// create dialog via fragment factory                                                                                                                                                                                                                      
				this._oViewSettingsDialog = sap.ui.xmlfragment(this.getView().getId(),                                                                                                                                                                                     
					"com.mscg.applications.cubiscan.worklist.view.ViewSettingsDialog", this);                                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
			// toggle compact style                                                                                                                                                                                                                                     
			jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this._oViewSettingsDialog);                                                                                                                                                                   
			this._oViewSettingsDialog.open();                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for the confirm action in the View Settings Dialog.                                                                                                                                                                                         
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @param {object} oEvent - Event object                                                                                                                                                                                                                     
		 */                                                                                                                                                                                                                                                          
		handleViewSettingsDialogConfirm: function(oEvent) {                                                                                                                                                                                                          
			var oView = this.getView();                                                                                                                                                                                                                                 
			var oTable = oView.byId("worklistTable");                                                                                                                                                                                                                   
			var mParams = oEvent.getParameters();                                                                                                                                                                                                                       
			var oBinding = oTable.getBinding("items");                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// apply filters to binding                                                                                                                                                                                                                                 
			var aFilters = this._constructFilters();                                                                                                                                                                                                                    
			jQuery.each(mParams.filterItems, function(i, oItem) {                                                                                                                                                                                                       
				var aSplit = oItem.getKey().split("__");                                                                                                                                                                                                                   
				var sPath = aSplit[0];                                                                                                                                                                                                                                     
				var sOperator = aSplit[1];                                                                                                                                                                                                                                 
				var sValue1 = aSplit[2];                                                                                                                                                                                                                                   
				var oFilter = new Filter(sPath, sOperator, sValue1);                                                                                                                                                                                                       
				aFilters.push(oFilter);                                                                                                                                                                                                                                    
			});                                                                                                                                                                                                                                                         
			oBinding.filter(aFilters);                                                                                                                                                                                                                                  
			this._aFilters = aFilters;                                                                                                                                                                                                                                  
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Factory method for worklist item rendering.  Called for each line in the worklist items rendering.                                                                                                                                                        
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @param {String} sId id of the parent control                                                                                                                                                                                                              
		 * @param {sap.ui.model.ContextBinding} oContext context binding object, data essentially                                                                                                                                                                    
		 * @return {sap.m.ColumnListItem} List item                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		worklistItemsFactory: function(sId, oContext) {                                                                                                                                                                                                              
			var row = new sap.m.ColumnListItem(sId, {                                                                                                                                                                                                                   
				type: "Active",                                                                                                                                                                                                                                            
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.ObjectIdentifier({                                                                                                                                                                                                                              
						title: "{product}"                                                                                                                                                                                                                                       
					}),                                                                                                                                                                                                                                                       
					new sap.m.ObjectIdentifier({                                                                                                                                                                                                                              
						title: "{unitOfMeasure}"                                                                                                                                                                                                                                 
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{statusText}"                                                                                                                                                                                                                                     
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{updatedEcc}"                                                                                                                                                                                                                                     
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{eccUpdatedBy}"                                                                                                                                                                                                                                   
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{eccUpdatedTimestamp}"                                                                                                                                                                                                                            
					})                                                                                                                                                                                                                                                        
				]                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			return row;                                                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Triggered when the user chooses to change the selected warehouse value.                                                                                                                                                                                   
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @private                                                                                                                                                                                                                                                  
		 * @param {object} oEvent - Event object                                                                                                                                                                                                                     
		 */                                                                                                                                                                                                                                                          
		onWarehouseNumberValueHelpRequest: function(oEvent) {                                                                                                                                                                                                        
			var handleClose = function(oEventObj) {                                                                                                                                                                                                                     
				var oSelectedItem = oEventObj.getParameter("selectedItem");                                                                                                                                                                                                
				if (oSelectedItem) {                                                                                                                                                                                                                                       
					this.byId("warehouseNumberInput").setValue(oSelectedItem.getTitle());                                                                                                                                                                                     
				}                                                                                                                                                                                                                                                          
				oEventObj.getSource().getBinding("items").filter([]);                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
				// Create the filters and refresh.                                                                                                                                                                                                                         
				// Publish an event so that the Worklist controller can load data.                                                                                                                                                                                         
				this._oTable.unbindAggregation("items");                                                                                                                                                                                                                   
				var oEventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                            
				oEventBus.publish("com.mscg.applications.cubiscan.worklist.FioriConfiguration", "Loaded");                                                                                                                                                                 
			};                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			var selDialog = new sap.m.SelectDialog({                                                                                                                                                                                                                    
				title: "Warehouses",                                                                                                                                                                                                                                       
				items: {                                                                                                                                                                                                                                                   
					path: "/WarehouseNumberSet",                                                                                                                                                                                                                              
					template: new sap.m.StandardListItem({                                                                                                                                                                                                                    
						title: "{warehouseNumber}",                                                                                                                                                                                                                              
						description: "{description}",                                                                                                                                                                                                                            
						active: true                                                                                                                                                                                                                                             
					})                                                                                                                                                                                                                                                        
				},                                                                                                                                                                                                                                                         
				confirm: [handleClose, this],                                                                                                                                                                                                                              
				cancel: [handleClose, this]                                                                                                                                                                                                                                
			});                                                                                                                                                                                                                                                         
			selDialog.setModel(this.getOwnerComponent().getModel("mscgCommon"));                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			// toggle compact style                                                                                                                                                                                                                                     
			jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), selDialog);                                                                                                                                                                                   
			selDialog.open();                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler when the share in JAM button has been clicked                                                                                                                                                                                               
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onShareInJamPress: function() {                                                                                                                                                                                                                              
			var oViewModel = this.getModel("worklistView"),                                                                                                                                                                                                             
				oShareDialog = sap.ui.getCore().createComponent({                                                                                                                                                                                                          
					name: "sap.collaboration.components.fiori.sharing.dialog",                                                                                                                                                                                                
					settings: {                                                                                                                                                                                                                                               
						object: {                                                                                                                                                                                                                                                
							id: location.href,                                                                                                                                                                                                                                      
							share: oViewModel.getProperty("/shareOnJamTitle")                                                                                                                                                                                                       
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			oShareDialog.open();                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSearch: function(oEvent) {                                                                                                                                                                                                                                 
			if (oEvent.getParameters().refreshButtonPressed) {                                                                                                                                                                                                          
				// Search field's 'refresh' button has been pressed.                                                                                                                                                                                                       
				// This is visible if you select any master list item.                                                                                                                                                                                                     
				// In this case no new search is triggered, we only                                                                                                                                                                                                        
				// refresh the list binding.                                                                                                                                                                                                                               
				this.onRefresh();                                                                                                                                                                                                                                          
			} else {                                                                                                                                                                                                                                                    
				var aTableSearchState = [];                                                                                                                                                                                                                                
				var sQuery = oEvent.getParameter("query");                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				if (sQuery && sQuery.length > 0) {                                                                                                                                                                                                                         
					aTableSearchState = [new Filter("product", FilterOperator.Contains, sQuery)];                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
				this._applySearch(aTableSearchState);                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for refresh event. Keeps filter, sort                                                                                                                                                                                                       
		 * and group settings and refreshes the list binding.                                                                                                                                                                                                        
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onRefresh: function() {                                                                                                                                                                                                                                      
			var oTable = this.byId("table");                                                                                                                                                                                                                            
			oTable.getBinding("items").refresh();                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Triggered by the message dialog close event.                                                                                                                                                                                                              
		 * @function                                                                                                                                                                                                                                                 
		 * @param {object} oEvent - event object                                                                                                                                                                                                                     
		 */                                                                                                                                                                                                                                                          
		onMessagesDialogClose: function(oEvent) {                                                                                                                                                                                                                    
			this._getMessagesDialog().close();                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* internal methods                                            */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Used to display the messages dialog.                                                                                                                                                                                                                      
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @private                                                                                                                                                                                                                                                  
		 * @param {object} oMessages - JSON object                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		_displayMessages: function(oMessages) {                                                                                                                                                                                                                      
			var oJsonModel = new JSONModel(oMessages);                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// Display the dialog and bind to the odata model.                                                                                                                                                                                                          
			var oDialog = this._getMessagesDialog();                                                                                                                                                                                                                    
			oDialog.setModel(oJsonModel);                                                                                                                                                                                                                               
			oDialog.open();                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Triggered after the user confirms that they want to clear the worklist table.                                                                                                                                                                             
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @private                                                                                                                                                                                                                                                  
		 * @param {object} oAction                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		_clearWorklist: function(oAction) {                                                                                                                                                                                                                          
			if (oAction === sap.m.MessageBox.Action.OK) {                                                                                                                                                                                                               
				var oModel = this.getModel();                                                                                                                                                                                                                              
				var oObject = {                                                                                                                                                                                                                                            
					warehouseNumber: this.getOwnerComponent().getModel("fioriConfiguration").getProperty("/user/defaults/warehouseNumber"),                                                                                                                                   
					product: "*",                                                                                                                                                                                                                                             
					unitOfMeasure: "*"                                                                                                                                                                                                                                        
				};                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
				var sKey = oModel.createKey("WorklistItemSet", oObject);                                                                                                                                                                                                   
				oModel.remove("/" + sKey, {                                                                                                                                                                                                                                
					success: function(oData, oResponse) {                                                                                                                                                                                                                     
						var oMessages = JSON.parse(oResponse.headers["zmscg-messages"]);                                                                                                                                                                                         
						this._displayMessages(oMessages);                                                                                                                                                                                                                        
					}.bind(this),                                                                                                                                                                                                                                             
					error: function(oError) {                                                                                                                                                                                                                                 
						sap.m.MessageBox.error("Unknown error occurred while clearing the worklist", {                                                                                                                                                                           
							styleClass: "sapUiSizeCompact"                                                                                                                                                                                                                          
						});                                                                                                                                                                                                                                                      
					}.bind(this)                                                                                                                                                                                                                                              
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Returns the Messages dialog and if it is not already created, creates it and returns a reference.                                                                                                                                                         
		 * @function                                                                                                                                                                                                                                                 
		 * @return {sap.m.Dialog} returns an instance of the dialog                                                                                                                                                                                                  
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_getMessagesDialog: function() {                                                                                                                                                                                                                             
			// create dialog lazily                                                                                                                                                                                                                                     
			if (!this._oMessagesDialog) {                                                                                                                                                                                                                               
				// create dialog via fragment factory                                                                                                                                                                                                                      
				this._oMessagesDialog = sap.ui.xmlfragment(this.getView().getId(),                                                                                                                                                                                         
					"com.mscg.applications.cubiscan.worklist.view.MessageDialog", this);                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			return this._oMessagesDialog;                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_bindData: function(oTable, aFilters) {                                                                                                                                                                                                                      
			// Bind the list.                                                                                                                                                                                                                                           
			oTable.bindAggregation("items", {                                                                                                                                                                                                                           
				path: "/WorklistItemSet",                                                                                                                                                                                                                                  
				factory: this.worklistItemsFactory.bind(this),                                                                                                                                                                                                             
				sorter: {                                                                                                                                                                                                                                                  
					path: "product",                                                                                                                                                                                                                                          
					descending: false                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				filters: aFilters                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_constructFilters: function() {                                                                                                                                                                                                                              
			var filters = new Array();                                                                                                                                                                                                                                  
			var oConfigModel = this.getOwnerComponent().getModel("fioriConfiguration");                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			// Define the filters for use in the binding of the items.                                                                                                                                                                                                  
			var warehouseFilter = new sap.ui.model.Filter("warehouseNumber", sap.ui.model.FilterOperator.EQ, oConfigModel.getProperty(                                                                                                                                  
				"/user/defaults/warehouseNumber"));                                                                                                                                                                                                                        
			filters.push(warehouseFilter);                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			return filters;                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Shows the selected item on the object page                                                                                                                                                                                                                
		 * On phones a additional history entry is created                                                                                                                                                                                                           
		 * @param {sap.m.ObjectListItem} oItem selected Item                                                                                                                                                                                                         
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_showObject: function(oItem) {                                                                                                                                                                                                                               
			this.getRouter().navTo("object", {                                                                                                                                                                                                                          
				objectId: oItem.getBindingContext().getProperty("product")                                                                                                                                                                                                 
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Internal helper method to apply both filter and search state together on the list binding                                                                                                                                                                 
		 * @param {sap.ui.model.Filter[]} aTableSearchState An array of filters for the search                                                                                                                                                                       
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_applySearch: function(aTableSearchState) {                                                                                                                                                                                                                  
			var oTable = this.byId("table"),                                                                                                                                                                                                                            
				oViewModel = this.getModel("worklistView");                                                                                                                                                                                                                
			oTable.getBinding("items").filter(aTableSearchState, "Application");                                                                                                                                                                                        
			// changes the noDataText of the list in case there are no filter results                                                                                                                                                                                   
			if (aTableSearchState.length !== 0) {                                                                                                                                                                                                                       
				oViewModel.setProperty("/tableNoDataText", this.getResourceBundle().getText("worklistNoDataWithSearchText"));                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            