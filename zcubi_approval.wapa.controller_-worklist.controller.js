sap.ui.define([                                                                                                                                                                                                                                                
	"com/mscg/applications/cubiscan/approval/controller/BaseController",                                                                                                                                                                                          
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/ui/core/routing/History",                                                                                                                                                                                                                                
	"com/mscg/applications/cubiscan/approval/model/formatter",                                                                                                                                                                                                    
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator"                                                                                                                                                                                                                                 
], function(BaseController, JSONModel, History, formatter, Filter, FilterOperator) {                                                                                                                                                                           
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return BaseController.extend("com.mscg.applications.cubiscan.approval.controller.Worklist", {                                                                                                                                                                 
                                                                                                                                                                                                                                                               
		formatter: formatter,                                                                                                                                                                                                                                        
		_oTable: null,                                                                                                                                                                                                                                               
		_oToleranceExceptionsDialog: null,                                                                                                                                                                                                                           
		_oMessagesDialog: null,                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
		// Used to maintain a list of the updates/deletes currently in process.                                                                                                                                                                                      
		_aInProcessQueue: [],                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		// Used to combine the messages from the different update/delete tasks.                                                                                                                                                                                      
		_oMessages: null,                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* lifecycle methods                                           */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Called when the worklist controller is instantiated.                                                                                                                                                                                                      
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onInit: function() {                                                                                                                                                                                                                                         
			var oViewModel,                                                                                                                                                                                                                                             
				iOriginalBusyDelay,                                                                                                                                                                                                                                        
				oTable = this.byId("table");                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			var oEventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                             
			oEventBus.subscribe("com.mscg.applications.cubiscan.approval.FioriConfiguration", "Loaded", this.onLoadWorklistData, this);                                                                                                                                 
                                                                                                                                                                                                                                                               
			// Put down worklist table's original value for busy indicator delay,                                                                                                                                                                                       
			// so it can be restored later on. Busy handling on the table is                                                                                                                                                                                            
			// taken care of by the table itself.                                                                                                                                                                                                                       
			iOriginalBusyDelay = oTable.getBusyIndicatorDelay();                                                                                                                                                                                                        
			// keeps the search state                                                                                                                                                                                                                                   
			this._aTableSearchState = [];                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			// Model used to manipulate control states                                                                                                                                                                                                                  
			oViewModel = new JSONModel({                                                                                                                                                                                                                                
				worklistTableTitle: this.getResourceBundle().getText("worklistTableTitle"),                                                                                                                                                                                
				saveAsTileTitle: this.getResourceBundle().getText("saveAsTileTitle", this.getResourceBundle().getText("worklistViewTitle")),                                                                                                                               
				shareOnJamTitle: this.getResourceBundle().getText("worklistTitle"),                                                                                                                                                                                        
				shareSendEmailSubject: this.getResourceBundle().getText("shareSendEmailWorklistSubject"),                                                                                                                                                                  
				shareSendEmailMessage: this.getResourceBundle().getText("shareSendEmailWorklistMessage", [location.href]),                                                                                                                                                 
				tableNoDataText: this.getResourceBundle().getText("tableNoDataText"),                                                                                                                                                                                      
				tableBusyDelay: 0,                                                                                                                                                                                                                                         
				selectedWarehouseNumber: "0500"                                                                                                                                                                                                                            
			});                                                                                                                                                                                                                                                         
			this.setModel(oViewModel, "worklistView");                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// Make sure, busy indication is showing immediately so there is no                                                                                                                                                                                         
			// break after the busy indication for loading the view's meta data is                                                                                                                                                                                      
			// ended (see promise 'oWhenMetadataIsLoaded' in AppController)                                                                                                                                                                                             
			oTable.attachEventOnce("updateFinished", function() {                                                                                                                                                                                                       
				// Restore original busy indicator delay for worklist's table                                                                                                                                                                                              
				oViewModel.setProperty("/tableBusyDelay", iOriginalBusyDelay);                                                                                                                                                                                             
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			this._oTable = oTable;                                                                                                                                                                                                                                      
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onExit: function() {                                                                                                                                                                                                                                         
			var oEventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                             
			oEventBus.unsubscribe("com.mscg.applications.cubiscan.approval.FioriConfiguration", "Loaded", this.onLoadWorklistData, this);                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* event handlers                                              */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Triggered by the table's 'updateFinished' event: after new table                                                                                                                                                                                          
		 * data is available, this handler method updates the table counter.                                                                                                                                                                                         
		 * This should only happen if the update was successful, which is                                                                                                                                                                                            
		 * why this handler is attached to 'updateFinished' and not to the                                                                                                                                                                                           
		 * table's list binding's 'dataReceived' method.                                                                                                                                                                                                             
		 * @param {sap.ui.base.Event} oEvent the update finished event                                                                                                                                                                                               
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onUpdateFinished: function(oEvent) {                                                                                                                                                                                                                         
			// update the worklist's object counter after the table update                                                                                                                                                                                              
			var sTitle,                                                                                                                                                                                                                                                 
				oTable = oEvent.getSource(),                                                                                                                                                                                                                               
				iTotalItems = oEvent.getParameter("total");                                                                                                                                                                                                                
			// only update the counter if the length is final and                                                                                                                                                                                                       
			// the table is not empty                                                                                                                                                                                                                                   
			if (iTotalItems && oTable.getBinding("items").isLengthFinal()) {                                                                                                                                                                                            
				sTitle = this.getResourceBundle().getText("worklistTableTitleCount", [iTotalItems]);                                                                                                                                                                       
			} else {                                                                                                                                                                                                                                                    
				sTitle = this.getResourceBundle().getText("worklistTableTitle");                                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
			this.getModel("worklistView").setProperty("/worklistTableTitle", sTitle);                                                                                                                                                                                   
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler when a table item gets pressed                                                                                                                                                                                                              
		 * @param {sap.ui.base.Event} oEvent the table selectionChange event                                                                                                                                                                                         
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onPress: function(oEvent) {                                                                                                                                                                                                                                  
			// The source is the list item that got pressed                                                                                                                                                                                                             
			this._showObject(oEvent.getSource());                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onLoadWorklistData: function(sChannel, sEvent, oData) {                                                                                                                                                                                                      
			// Define the filters for use in the binding of the items.                                                                                                                                                                                                  
			var aFilters = this._constructFilters();                                                                                                                                                                                                                    
			this._bindData(this._oTable, aFilters);                                                                                                                                                                                                                     
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onApproveItems: function(oEvent) {                                                                                                                                                                                                                           
			var oItems = this._oTable.getSelectedItems();                                                                                                                                                                                                               
			this._aInProcessQueue = new Array();                                                                                                                                                                                                                        
			this._oMessages = null;                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			if (oItems.length === 0) {                                                                                                                                                                                                                                  
				// Tell the user he didn't select any entries.  (Dork)                                                                                                                                                                                                     
				sap.m.MessageBox.error("No items were selected for approval.", {                                                                                                                                                                                           
					styleClass: "sapUiSizeCompact"                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				var oModel = this.getModel();                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				// Loop through the items and approve.                                                                                                                                                                                                                     
				for (var i = 0; i < oItems.length; i++) {                                                                                                                                                                                                                  
					var oBindingContext = oItems[i].getBindingContext();                                                                                                                                                                                                      
					var sPath = oBindingContext.getPath();                                                                                                                                                                                                                    
					var oObject = oBindingContext.getObject();                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
					// Update the object.                                                                                                                                                                                                                                     
					oObject.status = 'U';                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
					// Delete the worklistReviewItemExceptions so that we can update.  Hack but it works I guess...                                                                                                                                                           
					delete oObject.worklistReviewItemExceptions;                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
					// Push the object into the In-Process queue so we know how many items are in the process                                                                                                                                                                 
					// of being updated.  Will be popped from the queue when the success method is triggered.                                                                                                                                                                 
					this._aInProcessQueue.push(oObject);                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					// Trigger the OData update method.                                                                                                                                                                                                                       
					oModel.update(sPath, oObject, {                                                                                                                                                                                                                           
						success: this._onApproveSuccess.bind(this),                                                                                                                                                                                                              
						error: this._onError.bind(this)                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onRejectItems: function(oEvent) {                                                                                                                                                                                                                            
			var oItems = this._oTable.getSelectedItems();                                                                                                                                                                                                               
			this._aInProcessQueue = new Array();                                                                                                                                                                                                                        
			this._oMessages = null;                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			if (oItems.length === 0) {                                                                                                                                                                                                                                  
				// Tell the user he didn't select any entries.  (Dork)                                                                                                                                                                                                     
				sap.m.MessageBox.error("No items were selected for rejection.", {                                                                                                                                                                                          
					styleClass: "sapUiSizeCompact"                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				var oModel = this.getModel();                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
				// Loop through the items and approve.                                                                                                                                                                                                                     
				for (var i = 0; i < oItems.length; i++) {                                                                                                                                                                                                                  
					var oBindingContext = oItems[i].getBindingContext();                                                                                                                                                                                                      
					var sPath = oBindingContext.getPath();                                                                                                                                                                                                                    
					var oObject = oBindingContext.getObject();                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
					// Push the object into the In-Process queue so we know how many items are in the process                                                                                                                                                                 
					// of being updated.  Will be popped from the queue when the success method is triggered.                                                                                                                                                                 
					this._aInProcessQueue.push(oObject);                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					// Trigger the OData update method.                                                                                                                                                                                                                       
					oModel.remove(sPath, {                                                                                                                                                                                                                                    
						success: this._onApproveSuccess.bind(this),                                                                                                                                                                                                              
						error: this._onError.bind(this)                                                                                                                                                                                                                          
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Factory method for worklist item rendering.  Called for each line in the worklist items rendering.                                                                                                                                                        
		 *&nbsp;                                                                                                                                                                                                                                                     
		 * @function                                                                                                                                                                                                                                                 
		 * @param {String} sId id of the parent control                                                                                                                                                                                                              
		 * @param {sap.ui.model.ContextBinding} oContext context binding object, data essentially                                                                                                                                                                    
		 */                                                                                                                                                                                                                                                          
		worklistItemsFactory: function(sId, oContext) {                                                                                                                                                                                                              
			var bHasExceptions = (oContext.getProperty("hasExceptions") === "X") ? true : false;                                                                                                                                                                        
			var oButtonsContainer = new sap.m.HBox();                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
			oButtonsContainer.addItem(new sap.m.Button({                                                                                                                                                                                                                
				icon: "sap-icon://error",                                                                                                                                                                                                                                  
				type: "Reject",                                                                                                                                                                                                                                            
				tooltip: "Exceptions",                                                                                                                                                                                                                                     
				press: [this.onShowExceptions, this],                                                                                                                                                                                                                      
				visible: bHasExceptions                                                                                                                                                                                                                                    
			}));                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			var row = new sap.m.ColumnListItem(sId, {                                                                                                                                                                                                                   
				type: "Active",                                                                                                                                                                                                                                            
				cells: [                                                                                                                                                                                                                                                   
					new sap.m.ObjectIdentifier({                                                                                                                                                                                                                              
						title: "{product}"                                                                                                                                                                                                                                       
					}),                                                                                                                                                                                                                                                       
					new sap.m.ObjectIdentifier({                                                                                                                                                                                                                              
						title: "{unitOfMeasure}"                                                                                                                                                                                                                                 
					}),                                                                                                                                                                                                                                                       
					oButtonsContainer,                                                                                                                                                                                                                                        
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{length}"                                                                                                                                                                                                                                         
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{oldLength}"                                                                                                                                                                                                                                      
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{width}"                                                                                                                                                                                                                                          
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{oldWidth}"                                                                                                                                                                                                                                       
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{height}"                                                                                                                                                                                                                                         
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{oldHeight}"                                                                                                                                                                                                                                      
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{dimensionUom}"                                                                                                                                                                                                                                   
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{grossWeight}"                                                                                                                                                                                                                                    
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{oldGrossWeight}"                                                                                                                                                                                                                                 
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{weightUom}"                                                                                                                                                                                                                                      
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{volume}"                                                                                                                                                                                                                                         
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{oldVolume}"                                                                                                                                                                                                                                      
					}),                                                                                                                                                                                                                                                       
					new sap.m.Text({                                                                                                                                                                                                                                          
						text: "{volumeUom}"                                                                                                                                                                                                                                      
					})                                                                                                                                                                                                                                                        
				]                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			return row;                                                                                                                                                                                                                                                 
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onWarehouseNumberValueHelpRequest: function(oEvent) {                                                                                                                                                                                                        
			var handleClose = function(oEventObj) {                                                                                                                                                                                                                     
				var oSelectedItem = oEventObj.getParameter("selectedItem");                                                                                                                                                                                                
				if (oSelectedItem) {                                                                                                                                                                                                                                       
					this.byId("warehouseNumberInput").setValue(oSelectedItem.getTitle());                                                                                                                                                                                     
				}                                                                                                                                                                                                                                                          
				oEventObj.getSource().getBinding("items").filter([]);                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
				// Create the filters and refresh.                                                                                                                                                                                                                         
				// Publish an event so that the Worklist controller can load data.                                                                                                                                                                                         
				this._oTable.unbindAggregation("items");                                                                                                                                                                                                                   
				var oEventBus = sap.ui.getCore().getEventBus();                                                                                                                                                                                                            
				oEventBus.publish("com.mscg.applications.cubiscan.approval.FioriConfiguration", "Loaded");                                                                                                                                                                 
			};                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			var selDialog = new sap.m.SelectDialog({                                                                                                                                                                                                                    
				title: "Warehouses",                                                                                                                                                                                                                                       
				items: {                                                                                                                                                                                                                                                   
					path: "/WarehouseNumberSet",                                                                                                                                                                                                                              
					template: new sap.m.StandardListItem({                                                                                                                                                                                                                    
						title: "{warehouseNumber}",                                                                                                                                                                                                                              
						description: "{description}",                                                                                                                                                                                                                            
						active: true                                                                                                                                                                                                                                             
					})                                                                                                                                                                                                                                                        
				},                                                                                                                                                                                                                                                         
				confirm: [handleClose, this],                                                                                                                                                                                                                              
				cancel: [handleClose, this]                                                                                                                                                                                                                                
			});                                                                                                                                                                                                                                                         
			selDialog.setModel(this.getOwnerComponent().getModel("mscgCommon"));                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			// toggle compact style                                                                                                                                                                                                                                     
			jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), selDialog);                                                                                                                                                                                   
			selDialog.open();                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler when the share in JAM button has been clicked                                                                                                                                                                                               
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onShareInJamPress: function() {                                                                                                                                                                                                                              
			var oViewModel = this.getModel("worklistView"),                                                                                                                                                                                                             
				oShareDialog = sap.ui.getCore().createComponent({                                                                                                                                                                                                          
					name: "sap.collaboration.components.fiori.sharing.dialog",                                                                                                                                                                                                
					settings: {                                                                                                                                                                                                                                               
						object: {                                                                                                                                                                                                                                                
							id: location.href,                                                                                                                                                                                                                                      
							share: oViewModel.getProperty("/shareOnJamTitle")                                                                                                                                                                                                       
						}                                                                                                                                                                                                                                                        
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			oShareDialog.open();                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onSearch: function(oEvent) {                                                                                                                                                                                                                                 
			if (oEvent.getParameters().refreshButtonPressed) {                                                                                                                                                                                                          
				// Search field's 'refresh' button has been pressed.                                                                                                                                                                                                       
				// This is visible if you select any master list item.                                                                                                                                                                                                     
				// In this case no new search is triggered, we only                                                                                                                                                                                                        
				// refresh the list binding.                                                                                                                                                                                                                               
				this.onRefresh();                                                                                                                                                                                                                                          
			} else {                                                                                                                                                                                                                                                    
				var aTableSearchState = [];                                                                                                                                                                                                                                
				var sQuery = oEvent.getParameter("query");                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
				if (sQuery && sQuery.length > 0) {                                                                                                                                                                                                                         
					aTableSearchState = [new Filter("product", FilterOperator.Contains, sQuery)];                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
				this._applySearch(aTableSearchState);                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Event handler for refresh event. Keeps filter, sort                                                                                                                                                                                                       
		 * and group settings and refreshes the list binding.                                                                                                                                                                                                        
		 * @public                                                                                                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onRefresh: function() {                                                                                                                                                                                                                                      
			var oTable = this.byId("table");                                                                                                                                                                                                                            
			oTable.getBinding("items").refresh();                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Looks up the selected object and then displays the screen to show the exceptions.&nbsp;                                                                                                                                                                   
		 */                                                                                                                                                                                                                                                          
		onShowExceptions: function(oEvent) {                                                                                                                                                                                                                         
			var sPath = oEvent.getSource().getBindingContext().getPath();                                                                                                                                                                                               
			var oDialog = this._getExceptionsDialog();                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			this._bindExceptionsDialog(sPath, oDialog);                                                                                                                                                                                                                 
			window.setTimeout(function() {                                                                                                                                                                                                                              
				oDialog.open();                                                                                                                                                                                                                                            
			}, 500);                                                                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onMessagesDialogClose: function(oEvent) {                                                                                                                                                                                                                    
			this._getMessagesDialog().close();                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onExceptionsDialogClose: function(oEvent) {                                                                                                                                                                                                                  
			this._getExceptionsDialog().close();                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/* =========================================================== */                                                                                                                                                                                            
		/* internal methods                                            */                                                                                                                                                                                            
		/* =========================================================== */                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
		_onApproveSuccess: function(oData, oResponse) {                                                                                                                                                                                                              
			// Grab the key values object.  This will be used to determine if the changeset is                                                                                                                                                                          
			// complete or not.                                                                                                                                                                                                                                         
			var oUpdateKey = JSON.parse(oResponse.headers["zmscg-update-key"]);                                                                                                                                                                                         
			this._combineMessages(oResponse);                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			// Update the In-process Queue                                                                                                                                                                                                                              
			this._updateInProcessQueue(oUpdateKey);                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
			if (this._aInProcessQueue.length === 0) {                                                                                                                                                                                                                   
				this._displayMessages(this._oMessages);                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_onError: function(oError) {                                                                                                                                                                                                                                 
			//var oResponse = JSON.parse(oError.responseText);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			sap.m.MessageBox.error(                                                                                                                                                                                                                                     
				"An error occurred while attempting to update the item.", {                                                                                                                                                                                                
					styleClass: "sapUiSizeCompact"                                                                                                                                                                                                                            
				});                                                                                                                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_combineMessages: function(oResponse) {                                                                                                                                                                                                                      
			var oMessages = JSON.parse(oResponse.headers["zmscg-messages"]);                                                                                                                                                                                            
			if (this._oMessages === null) {                                                                                                                                                                                                                             
				this._oMessages = oMessages;                                                                                                                                                                                                                               
			} else {                                                                                                                                                                                                                                                    
				for (var i = 0; i < oMessages.messages.length; i++) {                                                                                                                                                                                                      
					this._oMessages.messages.push(oMessages.messages[i]);                                                                                                                                                                                                     
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_updateInProcessQueue: function(oUpdateKey) {                                                                                                                                                                                                                
			// Remove the item from the in-process queue.                                                                                                                                                                                                               
			this._aInProcessQueue = $.grep(this._aInProcessQueue, function(oObject, iIndex) {                                                                                                                                                                           
				if ((oObject.warehouseNumber === oUpdateKey.warehouseNumber) && (oObject.product === oUpdateKey.product) && (oObject.unitOfMeasure ===                                                                                                                     
						oUpdateKey.unitOfMeasure)) {                                                                                                                                                                                                                             
					return false;                                                                                                                                                                                                                                             
				} else {                                                                                                                                                                                                                                                   
					return true;                                                                                                                                                                                                                                              
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_displayMessages: function(oMessages) {                                                                                                                                                                                                                      
			var oJsonModel = new JSONModel(oMessages);                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
			// Display the dialog and bind to the odata model.                                                                                                                                                                                                          
			var oDialog = this._getMessagesDialog();                                                                                                                                                                                                                    
			oDialog.setModel(oJsonModel);                                                                                                                                                                                                                               
			oDialog.open();                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Returns the Messages dialog and if it is not already created, creates it and returns a reference.                                                                                                                                                         
		 * @function                                                                                                                                                                                                                                                 
		 * @return {sap.m.Dialog} returns an instance of the dialog                                                                                                                                                                                                  
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_getMessagesDialog: function() {                                                                                                                                                                                                                             
			// create dialog lazily                                                                                                                                                                                                                                     
			if (!this._oMessagesDialog) {                                                                                                                                                                                                                               
				// create dialog via fragment factory                                                                                                                                                                                                                      
				this._oMessagesDialog = sap.ui.xmlfragment(this.getView().getId(),                                                                                                                                                                                         
					"com.mscg.applications.cubiscan.approval.view.MessageDialog", this);                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			return this._oMessagesDialog;                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Returns the Exceptions dialog and if it is not already created, creates it and returns a reference.                                                                                                                                                       
		 * @function                                                                                                                                                                                                                                                 
		 * @return {sap.m.Dialog} returns an instance of the dialog                                                                                                                                                                                                  
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_getExceptionsDialog: function() {                                                                                                                                                                                                                           
			// create dialog lazily                                                                                                                                                                                                                                     
			if (!this._oExceptionsDialog) {                                                                                                                                                                                                                             
				// create dialog via fragment factory                                                                                                                                                                                                                      
				this._oExceptionsDialog = sap.ui.xmlfragment(this.getView().getId(),                                                                                                                                                                                       
					"com.mscg.applications.cubiscan.approval.view.ExceptionsDialog", this);                                                                                                                                                                                   
				this.getView().addDependent(this._oExceptionsDialog);                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			return this._oExceptionsDialog;                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Binds the exceptions data to the dialog object.  Once the data is bound, it opens the dialog window.                                                                                                                                                      
		 * @function                                                                                                                                                                                                                                                 
		 * @param {string} sPath binding path                                                                                                                                                                                                                        
		 * @param {sap.m.Dialog} oDialog dialog to bind the data too                                                                                                                                                                                                 
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_bindExceptionsDialog: function(sPath, oDialog) {                                                                                                                                                                                                            
			oDialog.bindElement({                                                                                                                                                                                                                                       
				path: sPath,                                                                                                                                                                                                                                               
				parameters: {                                                                                                                                                                                                                                              
					"expand": "worklistReviewItemExceptions"                                                                                                                                                                                                                  
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_bindData: function(oTable, aFilters) {                                                                                                                                                                                                                      
			// Bind the list.                                                                                                                                                                                                                                           
			oTable.bindAggregation("items", {                                                                                                                                                                                                                           
				path: "/WorklistReviewItemSet",                                                                                                                                                                                                                            
				factory: this.worklistItemsFactory.bind(this),                                                                                                                                                                                                             
				sorter: {                                                                                                                                                                                                                                                  
					path: "product",                                                                                                                                                                                                                                          
					descending: false                                                                                                                                                                                                                                         
				},                                                                                                                                                                                                                                                         
				filters: aFilters                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_constructFilters: function() {                                                                                                                                                                                                                              
			var filters = new Array();                                                                                                                                                                                                                                  
			var oViewModel = this.getModel("worklistView");                                                                                                                                                                                                             
			var oConfigModel = this.getOwnerComponent().getModel("fioriConfiguration");                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			// Define the filters for use in the binding of the items.                                                                                                                                                                                                  
			var warehouseFilter = new sap.ui.model.Filter("warehouseNumber", sap.ui.model.FilterOperator.EQ, oConfigModel.getProperty(                                                                                                                                  
				"/user/defaults/warehouseNumber"));                                                                                                                                                                                                                        
			filters.push(warehouseFilter);                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			return filters;                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Shows the selected item on the object page                                                                                                                                                                                                                
		 * On phones a additional history entry is created                                                                                                                                                                                                           
		 * @param {sap.m.ObjectListItem} oItem selected Item                                                                                                                                                                                                         
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_showObject: function(oItem) {                                                                                                                                                                                                                               
			this.getRouter().navTo("object", {                                                                                                                                                                                                                          
				objectId: oItem.getBindingContext().getProperty("product")                                                                                                                                                                                                 
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/**                                                                                                                                                                                                                                                          
		 * Internal helper method to apply both filter and search state together on the list binding                                                                                                                                                                 
		 * @param {sap.ui.model.Filter[]} aTableSearchState An array of filters for the search                                                                                                                                                                       
		 * @private                                                                                                                                                                                                                                                  
		 */                                                                                                                                                                                                                                                          
		_applySearch: function(aTableSearchState) {                                                                                                                                                                                                                  
			var oTable = this.byId("table"),                                                                                                                                                                                                                            
				oViewModel = this.getModel("worklistView");                                                                                                                                                                                                                
			oTable.getBinding("items").filter(aTableSearchState, "Application");                                                                                                                                                                                        
			// changes the noDataText of the list in case there are no filter results                                                                                                                                                                                   
			if (aTableSearchState.length !== 0) {                                                                                                                                                                                                                       
				oViewModel.setProperty("/tableNoDataText", this.getResourceBundle().getText("worklistNoDataWithSearchText"));                                                                                                                                              
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            